--PROCEDIMIENTOS
--PROCEDIMIENTO QUE INSERTA USUARIOS_EMPRESAS
CREATE OR REPLACE PROCEDURE INSERTAR_USUARIO_EMPRESA (nom in VARCHAR2, perfil in NUMERIC, rut in VARCHAR2, emp in VARCHAR2, correo in VARCHAR2)
IS
user_id USUARIO.ID%TYPE;
BEGIN
INSERT INTO USUARIO (ID, USERNAME, PASSWORD, PERFIL_ID) 
VALUES (round(dbms_random.value(10000,99999)), nom, round(dbms_random.value(1000,9999)), perfil)
RETURNING ID INTO user_id;
INSERT INTO EMPRESA (ID, RUT, NOMBRE, CORREO, USUARIO_ID) VALUES (round(dbms_random.value(10000,99999)), rut, emp, correo, user_id);
END;


--PROCEDIMIENTO QUE INSERTA USUARIOS_EMPLEADO
CREATE OR REPLACE PROCEDURE INSERTAR_USUARIO_EMPLEADO (userN in VARCHAR2, perfil in NUMERIC, rut in VARCHAR2, nom in VARCHAR2, ape in VARCHAR2, cargo in NUMERIC)
IS
user_id USUARIO.ID%TYPE;
BEGIN
INSERT INTO USUARIO (ID, USERNAME, PASSWORD, PERFIL_ID) 
VALUES (round(dbms_random.value(10000,99999)), userN, round(dbms_random.value(1000,9999)), perfil)
RETURNING ID INTO user_id;
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDO, RUT, CARGO_ID, USUARIO_ID) VALUES (round(dbms_random.value(10000,99999)), nom, ape, rut, cargo, user_id);
END;


--PROCEDIMIENTO QUE INSERTA USUARIOS_PROVEEDOR
CREATE OR REPLACE PROCEDURE INSERTAR_USUARIO_PROVEEDOR (userN in VARCHAR2, perfil in NUMERIC, rut in VARCHAR2, nom in VARCHAR2, tel in VARCHAR2, correo in VARCHAR2, rubro in NUMERIC)
IS
user_id USUARIO.ID%TYPE;
BEGIN
INSERT INTO USUARIO (ID, USERNAME, PASSWORD, PERFIL_ID) 
VALUES (round(dbms_random.value(10000,99999)), userN, round(dbms_random.value(1000,9999)), perfil)
RETURNING ID INTO user_id;
INSERT INTO PROVEEDOR (ID, NOMBRE, RUT, TELEFONO,  CORREO, RUBRO_ID, USUARIO_ID) VALUES (round(dbms_random.value(10000,99999)), nom, rut, tel, correo, rubro, user_id);
END;

--PROCEDIMIENTO QUE LISTA LOS USUARIOS Y SU PERFIL
CREATE OR REPLACE PROCEDURE seleccionaUsuarios (registros out sys_refcursor)
AS BEGIN
    OPEN registros for 
    SELECT USUARIO.ID, USUARIO.USERNAME, PERFIL.NOMBRE
    FROM USUARIO, PERFIL
    WHERE USUARIO.PERFIL_ID = PERFIL.ID;
END;


--PROCEDIMIENTO QUE RESERVA UNA HABITACION
create or replace PROCEDURE INSERTAR_RESERVA_HABITACION (huesped_id in NUMERIC , servicio_id in NUMERIC, archivo in VARCHAR2, 
total in NUMERIC, habitacion_id in NUMERIC, tipo_servicio_id in NUMERIC)
IS
BEGIN
Insert into ORDEN_COMPRA (ID,HUESPED_ID,SERVICIO_ID,ARCHIVO,TOTAL,HABITACION_ID,TIPO_SERVICIO_ID)
values (round(dbms_random.value(10000,99999)) ,huesped_id,servicio_id,archivo,total,habitacion_id,tipo_servicio_id);
END;

--PROCEDIMIENTO QUE RESERVA UNA HABITACION Y CREA EL HUESPED SI ES NUEVO
CREATE OR REPLACE PROCEDURE RESERVA_HABITACION_HUESPED (nombre in VARCHAR, apellido in VARCHAR, rut in VARCHAR, empresa_id in NUMERIC,
habitacion_id in NUMERIC, servicio_id in NUMERIC, archivo in VARCHAR, total in NUMERIC, tipo_servicio_id in NUMERIC)
IS
huesped_id USUARIO.ID%TYPE;
BEGIN
INSERT INTO HUESPED (ID, NOMBRE, APELLIDO, RUT, EMPRESA_ID, HABITACION_ID) VALUES
(round(dbms_random.value(10000,99999)), nombre, apellido, rut, empresa_id, habitacion_id)
RETURNING ID INTO huesped_id;
INSERT INTO ORDEN_COMPRA (ID,HUESPED_ID,SERVICIO_ID,ARCHIVO,TOTAL,HABITACION_ID,TIPO_SERVICIO_ID)
values (round(dbms_random.value(10000,99999)), huesped_id, servicio_id, archivo, total, habitacion_id, tipo_servicio_id);
END;

--PROCEDIMIENTO QUE CREA INSERTA UN PLATO
CREATE OR REPLACE PROCEDURE INSERTAR_PLATO (newNombre in VAECHAR2, newTipoServicio in NUMERIC)
IS BEGIN
INSERT INTO PLATOS (ID, NOMBRE, TIPO_SERVICIO_ID)
VALUES (round(dbms_random.value(10000, 99999)), newNombre, newTipoServicio);
END;



--PROCEDIMIENTO QUE INSERTA UNA ORDEN DE PEDIDO
CREATE OR REPLACE PROCEDURE INSERTAR_ORDEN_PEDIDO (newCantidad in NUMERIC, newTotal in NUMERIC, newEmpleadoId in NUMERIC, newProveedorId in Numeric, newProductoId in NUMERIC)
IS BEGIN
INSERT INTO ORDEN_PEDIDO (ID, CANTIDAD, TOTAL, EMPLEADO_ID, PROVEEDOR_ID, PRODUCTO_ID)
VALUES (round(dbms_random.value(10000, 99999)), newCantidad, newTotal, newEmpleadoId, newProveedorId, newProductoId);
END;


--PROCEDIMIENTO QUE INSERTA PRODUCTO
CREATE OR REPLACE PROCEDURE INSERTAR_PRODUCTO (newCodigo in NUMERIC, newNombre in VARCHAR2, newPrecio in NUMERIC,newTipoProductoId in NUMERIC, 
                                               newFamilia in NUMERIC, newDescripcion in VARCHAR2, newStock in NUMERIC, newStockCritico in NUMERIC)
IS BEGIN
INSERT INTO PRODUCTO (ID, CODIGO, NOMBRE, PRECIO, TIPO_PRODUCTO_ID, FAMILIA_ID, DESCRIPCION, STOCK, STOCK_CRITICO)
VALUES (round(dbms_random.value(10000, 99999)), newCodigo, newNombre, newPrecio,newTipoProductoId, 
                                               newFamilia, newDescripcion, newStock, newStockCritico);
END;

--Alteracion de la tabla producto para agregar DESCRIPCION STOCK y STOCK_CRITICO
ALTER TABLE PRODUCTO ADD DESCRIPCION VARCHAR2(100);

ALTER TABLE PRODUCTO ADD STOCK NUMBER(10);

ALTER TABLE PRODUCTO ADD STOCK_CRITICO NUMBER(10);


--PROCEDIMIENTO QUE LISTA LAS ORDENES DE PEDIDO 
CREATE OR REPLACE PROCEDURE seleccionaOrdenPedido (registros out sys_refcursor)
AS BEGIN
    OPEN registros for 
    SELECT ORDEN_PEDIDO.ID, ORDEN_PEDIDO.CANTIDAD, ORDEN_PEDIDO.TOTAL, PROVEEDOR.ID, PRODUCTO.NOMBRE
    FROM ORDEN_PEDIDO, PROVEEDOR, PRODUCTO
    WHERE ORDEN_PEDIDO.PROVEEDOR_ID = PROVEEDOR.ID and ORDEN_PEDIDO.PRODUCTO_ID = PRODUCTO.ID;
END;




--SECUENCIAS

--TRIGGERS

